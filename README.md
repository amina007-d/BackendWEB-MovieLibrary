# Movie Library API - Assignment 3 Part 1

A backend API built with Node.js, Express, and MongoDB for managing a movie collection.

## Team Members
- **Amina Dossan** – GET routes, filtering, and queries
- **Yerassyl Alimbek** – POST route and validation
- **Nazerke Abdizhamal** – PUT route and custom middleware
- **Almat Zhamsat** – DELETE route and error handling

## Technologies
- Node.js
- Express.js
- MongoDB (native driver)

## Setup Instructions

### 1. Install MongoDB
Download and install MongoDB Community Server from: https://www.mongodb.com/try/download/community

### 2. Start MongoDB
```bash
# On Windows
"C:\Program Files\MongoDB\Server\7.0\bin\mongod.exe" --dbpath="C:\data\db"

# On macOS (with Homebrew)
brew services start mongodb-community

# On Linux
sudo systemctl start mongod
```

### 3. Install Dependencies
```bash
npm install
```

### 4. Start the Server
```bash
npm start
```

Server will run on: http://localhost:3000

## API Documentation

### Base URL
```
http://localhost:3000/api/movies
```

### Endpoints

#### 1. GET /api/movies
Get all movies with optional filtering, sorting, and projection.

**Query Parameters:**
- `genre` - Filter by genre (e.g., `?genre=Action`)
- `year` - Filter by year (e.g., `?year=2023`)
- `title` - Search by title (case-insensitive, e.g., `?title=inception`)
- `sortBy` - Sort by field (e.g., `?sortBy=year`)
- `order` - Sort order: `asc` or `desc` (e.g., `?order=desc`)
- `fields` - Select specific fields (e.g., `?fields=title,year`)

**Examples:**
```
GET /api/movies
GET /api/movies?genre=Action
GET /api/movies?year=2023&sortBy=rating&order=desc
GET /api/movies?fields=title,year,rating
```

**Response (200 OK):**
```json
{
  "count": 2,
  "data": [
    {
      "_id": "507f1f77bcf86cd799439011",
      "title": "Inception",
      "genre": "Sci-Fi",
      "year": 2010,
      "rating": 8.8,
      "director": "Christopher Nolan",
      "description": "A mind-bending thriller"
    }
  ]
}
```

#### 2. GET /api/movies/:id
Get a single movie by ID.

**Response (200 OK):**
```json
{
  "_id": "507f1f77bcf86cd799439011",
  "title": "Inception",
  "genre": "Sci-Fi",
  "year": 2010,
  "rating": 8.8
}
```

**Error Responses:**
- `400` - Invalid ID format
- `404` - Movie not found

#### 3. POST /api/movies
Create a new movie.

**Request Body:**
```json
{
  "title": "The Matrix",
  "genre": "Sci-Fi",
  "year": 1999,
  "rating": 8.7,
  "director": "The Wachowskis",
  "description": "A computer hacker learns about the true nature of reality"
}
```

**Required fields:** `title`, `genre`, `year`

**Response (201 Created):**
```json
{
  "message": "Movie created successfully",
  "data": {
    "_id": "507f1f77bcf86cd799439011",
    "title": "The Matrix",
    "genre": "Sci-Fi",
    "year": 1999,
    "rating": 8.7,
  }
}
```

**Error Responses:**
- `400` - Missing required fields or invalid data

#### 4. PUT /api/movies/:id
Update an existing movie.

**Request Body:**
```json
{
  "title": "The Matrix Reloaded",
  "genre": "Sci-Fi",
  "year": 2003,
  "rating": 7.2
}
```

**Response (200 OK):**
```json
{
  "message": "Movie updated successfully",
  "data": {
    "_id": "507f1f77bcf86cd799439011",
    "title": "The Matrix Reloaded",
    "genre": "Sci-Fi",
    "year": 2003,
    "rating": 7.2,
    "updatedAt": "2024-01-15T11:00:00.000Z"
  }
}
```

**Error Responses:**
- `400` - Invalid ID or missing fields
- `404` - Movie not found

#### 5. DELETE /api/movies/:id
Delete a movie.

**Response (200 OK):**
```json
{
  "message": "Movie deleted successfully",
  "deletedId": "507f1f77bcf86cd799439011"
}
```

**Error Responses:**
- `400` - Invalid ID format
- `404` - Movie not found

## Data Model
```javascript
{
  _id: ObjectId,           // Auto-generated by MongoDB
  title: String,           // Required
  genre: String,           // Required
  year: Number,            // Required (1800 - current year + 5)
  rating: Number,          // Optional (0-10)
  director: String,        // Optional
  description: String,     // Optional
  createdAt: Date,         // Auto-generated
  updatedAt: Date          // Auto-generated on update
}
```

## Testing the API

### Using Browser (GET only)
Visit http://localhost:3000 and click the test links

### Using curl
```bash
# Get all movies
curl http://localhost:3000/api/movies

# Create a movie
curl -X POST http://localhost:3000/api/movies \
  -H "Content-Type: application/json" \
  -d '{"title":"Inception","genre":"Sci-Fi","year":2010,"rating":8.8}'

# Update a movie
curl -X PUT http://localhost:3000/api/movies/YOUR_MOVIE_ID \
  -H "Content-Type: application/json" \
  -d '{"title":"Inception","genre":"Sci-Fi","year":2010,"rating":9.0}'

# Delete a movie
curl -X DELETE http://localhost:3000/api/movies/YOUR_MOVIE_ID
```

### Using Postman or Thunder Client
1. Import the endpoints listed above
2. Set headers: `Content-Type: application/json`
3. Add request body for POST/PUT requests

## Project Structure
```
movielibrary/
├── database/
│   └── db.js              # MongoDB connection
├── routes/
│   └── movies.js          # Movie CRUD routes
├── views/
│   ├── index.html         # Home page with test links
│   ├── about.html
│   ├── contact.html
│   └── 404.html
├── public/
│   └── style.css
├── server.js              # Main application file
├── package.json
└── README.md
```

## Features Implemented

MongoDB native driver integration  
Full CRUD operations  
Filtering by multiple fields  
Sorting (ascending/descending)  
Field projection  
Input validation  
Proper HTTP status codes  
Custom logger middleware  
Global 404 handler  
Home page with API test links  

## Assignment Requirements Checklist

- Node.js + Express project
- MongoDB native driver (no Mongoose)
- Clear folder structure (routes/, database/)
- express.json() middleware
- Custom logger middleware
- All CRUD routes implemented
- Filtering, sorting, projection
- Validation and proper status codes
- Home page with API test links
- Global 404 handler
- README.md with documentation
```

## Step 7: MongoDB Installation & Setup

### For Windows:
1. Download MongoDB Community Server: https://www.mongodb.com/try/download/community
2. Run the installer, choose "Complete" installation
3. Install MongoDB as a Service (check the option during installation)
4. Create data directory: `mkdir C:\data\db`
5. Start MongoDB: It should start automatically as a service, or run:
```
   "C:\Program Files\MongoDB\Server\7.0\bin\mongod.exe" --dbpath="C:\data\db"